<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="new-swc.png" />
<title>Boublok - HTML & p5.js Editor</title>

<!-- CodeMirror CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">

<style>
  * { box-sizing: border-box; }
  body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  .editor-container {
    display: flex;
    flex-direction: column;
    flex: 1;
  }
  .editor-buttons {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    background-color: #007bff;
    color: white;
  }
  .editor-buttons button {
    padding: 10px 20px;
    border: none;
    background-color: #007bff;
    color: white;
    cursor: pointer;
  }
  .editor-buttons button:hover {
    background-color: #0056b3;
  }
  .editor {
    flex: 1;
    display: flex;
    gap: 1px;
    background: #ddd;
  }
  .CodeMirror {
    flex: 1;
    height: 100%;
    font-size: 14px;
  }
  iframe {
    flex: 1;
    border: none;
    margin: 0;
  }
  .note {
    padding: 10px;
    font-size: 14px;
    color: #555;
    background-color: #fff;
    border-top: 1px solid #ddd;
  }

  /* === Custom Syntax Highlight Overrides (increased specificity) === */
  .CodeMirror .cm-tag {
    color: #4FC3F7 !important; /* bright blue for tag names */
    font-weight: bold;
  }
  .CodeMirror .cm-attribute {
    color: #FFB74D !important; /* warm orange for attribute names */
  }
  .CodeMirror .cm-string {
    color: #A5D6A7 !important; /* soft green for attribute values */
  }
  .CodeMirror .cm-keyword {
    color: #BA68C8 !important; /* purple for JS keywords */
    font-weight: bold;
  }
  .CodeMirror .cm-property {
    color: #FFD54F !important; /* yellow for CSS properties */
  }
  .CodeMirror .cm-atom {
    color: #81C784 !important; /* green for CSS values */
  }
  .CodeMirror .cm-comment {
    color: #90A4AE !important; /* grey for comments */
    font-style: italic;
  }
</style>
</head>
<body>
  <div class="editor-buttons">
    <button onclick="runCode()">Run</button>
    <button onclick="saveCode()">Save</button>
    <button id="switch-btn" onclick="switchEditor()">Switch to p5.js</button>
  </div>
  <div class="editor-container">
    <div id="html-editor" class="editor">
      <textarea id="html-code"></textarea>
      <iframe id="output" sandbox="allow-scripts allow-same-origin" referrerpolicy="no-referrer"></iframe>
    </div>
    <div id="p5-editor" class="editor" style="display: none;">
      <textarea id="p5-code"></textarea>
      <iframe id="p5-output" sandbox="allow-scripts allow-same-origin" referrerpolicy="no-referrer"></iframe>
    </div>
  </div>
  <div class="note">
    Note: HTML editor supports HTML, CSS, JavaScript.  
    p5.js editor supports normal p5 global mode (`setup()` & `draw()`).
  </div>

<!-- CodeMirror JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>

<script>
  // Initialize CodeMirror editors
  const htmlEditor = CodeMirror.fromTextArea(document.getElementById('html-code'), {
    mode: 'htmlmixed',
    theme: 'material-darker',
    lineNumbers: true,
    tabSize: 2
  });

  const p5Editor = CodeMirror.fromTextArea(document.getElementById('p5-code'), {
    mode: 'javascript',
    theme: 'material-darker',
    lineNumbers: true,
    tabSize: 2
  });

  // Load saved code
  htmlEditor.setValue(localStorage.getItem('html-code') || '');
  p5Editor.setValue(localStorage.getItem('p5-code') || '');

  htmlEditor.on('change', () => localStorage.setItem('html-code', htmlEditor.getValue()));
  p5Editor.on('change', () => localStorage.setItem('p5-code', p5Editor.getValue()));

  function runCode() {
    const isHtmlVisible = document.getElementById('html-editor').style.display !== 'none';
    if (isHtmlVisible) {
      document.getElementById('output').srcdoc = htmlEditor.getValue();
    } else {
      const code = p5Editor.getValue();
      const html = `
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<style>html,body{margin:0;padding:0;}</style>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"><\/script>
</head>
<body>
<script>
${code}
<\/script>
</body>
</html>`;
      document.getElementById('p5-output').srcdoc = html;
    }
  }

  function saveCode() {
    const isHtmlVisible = document.getElementById('html-editor').style.display !== 'none';
    if (isHtmlVisible) {
      download('code.html', htmlEditor.getValue(), 'text/html');
    } else {
      const code = p5Editor.getValue();
      const html = `
<!doctype html>
<html><head><meta charset="utf-8">
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"><\/script>
</head><body>
<script>
${code}
<\/script>
</body></html>`;
      download('code-p5.html', html, 'text/html');
    }
  }

  function download(filename, content, type) {
    const blob = new Blob([content], { type });
    const a = Object.assign(document.createElement('a'), {
      href: URL.createObjectURL(blob),
      download: filename
    });
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 0);
  }

  function switchEditor() {
    const htmlDiv = document.getElementById('html-editor');
    const p5Div = document.getElementById('p5-editor');
    const button = document.getElementById('switch-btn');

    const htmlVisible = htmlDiv.style.display !== 'none';
    htmlDiv.style.display = htmlVisible ? 'none' : 'flex';
    p5Div.style.display = htmlVisible ? 'flex' : 'none';
    button.textContent = htmlVisible ? 'Switch to HTML' : 'Switch to p5.js';
  }

  // Ctrl/Cmd + Enter runs code
  document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
      e.preventDefault();
      runCode();
    }
  });
</script>
</body>
</html>
