<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>L√ªddiel ‚Äî share your sound</title>
  <style>
    :root{
      --bg:#0e0f12;
      --elev-1:#14161b;
      --elev-2:#1a1d23;
      --card:#161921;
      --border:#232733;
      --text:#e6e8ee;
      --muted:#aab1c3;
      --brand:#7b5cff;
      --brand-2:#5fe1d6;
      --accent:#ff7ab6;
      --success:#52d67a;
      --warning:#ffc857;
      --danger:#ff6b6b;
      --shadow:0 8px 24px rgba(0,0,0,.25), 0 2px 6px rgba(0,0,0,.2);
      --radius:16px;
      --radius-sm:12px;
      --radius-xs:10px;
      --gap:18px;
      --gap-sm:12px;
      --gap-lg:24px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:radial-gradient(1200px 800px at -10% -10%,rgba(123,92,255,.18),transparent 40%),
                 radial-gradient(1000px 700px at 110% -20%,rgba(95,225,214,.15),transparent 40%),
                 var(--bg);
      color:var(--text);
      font: 15px/1.5 ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      letter-spacing:.2px;
    }
    a{color:inherit;text-decoration:none}
    button{font:inherit}

    /* Top bar */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(14,15,18,.85), rgba(14,15,18,.6));
      border-bottom:1px solid var(--border);
    }
    .topbar-inner{
      display:flex; align-items:center; gap:12px;
      max-width:1200px; margin:0 auto; padding:14px 18px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.5px;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      font-size:22px;
    }
    .brand-badge{
      width:30px; height:30px; border-radius:10px;
      background: conic-gradient(from 200deg, var(--brand), var(--brand-2), var(--accent));
      box-shadow:0 0 0 2px rgba(255,255,255,.06), 0 8px 18px rgba(0,0,0,.35) inset;
      display:grid; place-items:center; color:white; font-size:14px; font-weight:900;
    }
    .search{
      flex:1; display:flex; align-items:center; gap:8px;
      background: var(--elev-2); border:1px solid var(--border);
      padding:8px 12px; border-radius:999px;
    }
    .search input{
      flex:1; background:transparent; border:none; outline:none; color:var(--text);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 14px; border-radius:999px; border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.0));
      color:var(--text); cursor:pointer;
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
    }
    .pill:hover{transform: translateY(-1px); border-color:#2e3444}
    .pill.primary{
      background: linear-gradient(135deg, rgba(123,92,255,.25), rgba(95,225,214,.22));
      border-color: transparent;
    }
    .file-input{display:none}
    .avatar{
      width:34px; height:34px; border-radius:50%;
      background: linear-gradient(135deg, #2b2f3b, #232735);
      border:1px solid var(--border);
      display:grid; place-items:center; font-weight:700; color:#c9cee1; font-size:12px;
    }

    /* Layout */
    .container{
      max-width:1200px; margin:20px auto; padding:0 18px;
      display:grid; grid-template-columns:260px minmax(0,1fr) 320px; gap:var(--gap);
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0));
      border:1px solid var(--border); border-radius:var(--radius);
      box-shadow: var(--shadow);
    }
    .section{padding:16px}
    .sidebar .item{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; color:var(--text);
      border:1px solid transparent;
    }
    .sidebar .item:hover{background:var(--elev-2); border-color:var(--border)}
    .sidebar h3{
      color:#d6daea; font-size:14px; font-weight:800; letter-spacing:.4px;
      margin:6px 12px 8px;
      text-transform:uppercase;
    }
    .muted{color:var(--muted)}
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px; border:1px solid var(--border);
      color:#d8dcef; background: #151823;
      font-size:12px;
    }
    .tag .dot{
      width:8px; height:8px; border-radius:50%;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      box-shadow:0 0 0 2px rgba(123,92,255,.15);
    }

    /* Composer */
    .composer{padding:16px}
    .composer .row{
      display:flex; align-items:center; gap:12px; margin-bottom:12px;
    }
    .composer textarea{
      width:100%; min-height:70px; resize:vertical;
      background:#141823; color:var(--text); border:1px solid var(--border);
      border-radius:12px; padding:12px;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px;
      border:1px dashed #2a3141; background:#161b26; color:#cdd3e6;
    }

    /* Post */
    .post{padding:16px; display:flex; flex-direction:column; gap:12px}
    .post + .post{border-top:1px solid var(--border)}
    .post-head{display:flex; align-items:center; gap:12px}
    .post-head .who{display:flex; flex-direction:column}
    .post-head .name{font-weight:800}
    .post-head .meta{font-size:12px; color:var(--muted)}
    .post-audio{
      background: linear-gradient(180deg, #141824, #121522);
      border:1px solid var(--border); border-radius:14px; padding:12px;
    }
    .post-audio .title{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px;
    }
    .wave{
      height:44px; border-radius:10px; overflow:hidden; border:1px solid #263046;
      background:
        repeating-linear-gradient(90deg, rgba(95,225,214,.15) 0 2px, transparent 2px 6px),
        linear-gradient(135deg, rgba(123,92,255,.25), rgba(95,225,214,.18));
    }
    audio{width:100%; margin-top:10px; filter: saturate(1.1) hue-rotate(-5deg)}
    .actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .btn{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px;
      border:1px solid var(--border); background:#141823; color:#dbe0f3; cursor:pointer;
    }
    .btn:hover{border-color:#2f3a54}
    .btn.ghost{background:transparent}
    .stat{font-size:12px; color:var(--muted)}

    /* Right rail */
    .list{display:flex; flex-direction:column; gap:10px}
    .creator{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px; border:1px solid var(--border); border-radius:12px; background:#151a25;
    }
    .creator .left{display:flex; align-items:center; gap:10px}
    .mini{width:28px; height:28px; border-radius:50%; background:linear-gradient(135deg,#2b2f3b,#232735); border:1px solid var(--border); display:grid; place-items:center; font-size:11px; color:#c9cee1; font-weight:700}

    /* Utility for your JS */
    .status{ text-align:center; color:var(--muted); margin:10px 0 16px; }
    .error{ color: var(--danger); }
    .audio-post{
      background: linear-gradient(180deg, #141824, #121522);
      border:1px solid var(--border);
      border-radius:14px;
      padding:14px;
      margin:14px 0;
      box-shadow: var(--shadow);
    }
    .audio-post .meta{ font-size:12px; color:var(--muted); margin-bottom:8px; }

    /* Footer */
    footer{max-width:1200px; margin:30px auto; padding:0 18px 40px; color:var(--muted); font-size:13px}

    /* Responsive */
    @media (max-width: 1100px){
      .container{grid-template-columns:240px minmax(0,1fr)}
      .right{display:none}
    }
    @media (max-width: 780px){
      .container{grid-template-columns:1fr}
      .left{display:none}
      .topbar-inner{gap:10px}
      .search{display:none}
    }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="brand" aria-label="L√ªddiel home">
        <span class="brand-badge">‚ô™</span> L√ªddiel
      </div>

      <form class="search" role="search" aria-label="Search sounds">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.2-4.2M10.8 18a7.2 7.2 0 1 1 0-14.4 7.2 7.2 0 0 1 0 14.4Z" stroke="#aab1c3" stroke-width="1.6" stroke-linecap="round"/></svg>
        <input type="search" placeholder="Search audio, creators, tags‚Ä¶" aria-label="Search input" />
      </form>

      <!-- This label triggers the file input inside the form below -->
      <label for="fileUpload" class="pill primary" title="Upload audio">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 16V4m0 0l4 4m-4-4L8 8M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2" stroke="#e6e8ee" stroke-width="1.6" stroke-linecap="round"/></svg>
        Upload
      </label>

      <div class="avatar" title="You">YO</div>
    </div>
  </header>

  <main class="container" role="main">
    <!-- Left sidebar -->
    <aside class="left sidebar">
      <div class="card section">
        <h3>Menu</h3>
        <a class="item" href="#"><span>üè†</span> <span>Home</span></a>
        <a class="item" href="#"><span>üîé</span> <span>Discover</span></a>
        <a class="item" href="#"><span>üéß</span> <span>Following</span></a>
        <a class="item" href="#"><span>üìª</span> <span>Playlists</span></a>
        <a class="item" href="#"><span>‚¨ÜÔ∏è</span> <span>Upload</span></a>
      </div>

      <div class="card section" style="margin-top:var(--gap)">
        <h3>Trending tags</h3>
        <div class="list">
          <p class="muted">No tags yet.</p>
        </div>
      </div>
    </aside>

    <!-- Feed -->
    <section aria-label="Feed" class="feed">
      <!-- Status from JS -->
      <div id="status" class="status"></div>

      <!-- Composer = your upload form -->
      <div class="card composer" aria-label="Share a sound">
        <form id="uploadForm">
          <div class="row" style="flex-wrap:wrap">
            <div class="avatar">YOU</div>
            <input type="text" name="sender" placeholder="Your name" required
                   style="flex:1; min-width:200px; background:#141823; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px;" />
            <label for="fileUpload" class="chip" role="button">
              <span>‚¨ÜÔ∏è</span> <span>Select audio file</span>
            </label>
            <input id="fileUpload" class="file-input" type="file" name="audio" accept="audio/*" />
          </div>

          <div class="row" style="justify-content:space-between; flex-wrap:wrap">
            <span class="muted">Supported: MP3, WAV, AAC ‚Ä¢ up to 20MB</span>
            <button class="pill" type="submit">Post</button>
          </div>
        </form>
      </div>

      <!-- Recording controls -->
      <div class="card section" style="display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:space-between">
        <div class="muted">Or record directly:</div>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button id="recordBtn" class="pill">üéôÔ∏è Start recording</button>
          <button id="stopBtn" class="pill" disabled>üõë Stop</button>
        </div>
        <audio id="recordedAudio" controls style="display:none; width:100%; margin-top:10px;"></audio>
      </div>

      <!-- Dynamic posts injected here -->
      <div id="feed"></div>
    </section>

    <!-- Right sidebar -->
    <aside class="right sidebar">
      <div class="card section">
        <h3>Top creators</h3>
        <div class="list">
          <p class="muted">No creators yet. Be the first to share!</p>
        </div>
      </div>

      <div class="card section" style="margin-top:var(--gap)">
        <h3>Discover playlists</h3>
        <div class="list">
          <p class="muted">No playlists yet.</p>
        </div>
      </div>
    </aside>
  </main>

  <footer>
    <div>L√ªddiel ‚Äî share what you hear.</div>
    <div class="muted" style="margin-top:6px">Waiting for your first post‚Ä¶</div>
  </footer>

  <script>
    // Point this to your Codespaces backend
    const API_BASE = 'https://studious-space-engine-694w59x5p7r9354xv-3000.app.github.dev';

    const form = document.getElementById('uploadForm');
    const feed = document.getElementById('feed');
    const recordBtn = document.getElementById('recordBtn');
    const stopBtn = document.getElementById('stopBtn');
    const recordedAudio = document.getElementById('recordedAudio');
    const statusEl = document.getElementById('status');

    let mediaRecorder;
    let recordedChunks = [];

    function setStatus(msg, isError = false) {
      statusEl.textContent = msg || '';
      statusEl.className = 'status' + (isError ? ' error' : '');
    }

    function resolveFileUrl(file) {
      // If backend returns a relative path (e.g., /uploads/xxx), prefix with API_BASE
      // If it ever returns absolute URLs, use as-is.
      return /^https?:\/\//i.test(file) ? file : `${API_BASE}${file}`;
    }

    async function loadAudioList() {
      setStatus('Loading posts...');
      try {
        const res = await fetch(`${API_BASE}/list`, { method: 'GET' });
        if (!res.ok) throw new Error(`List failed: ${res.status}`);
        const posts = await res.json();
        feed.innerHTML = '';
        if (!posts.length) {
          feed.innerHTML = '<p style="text-align:center;color:#aab1c3;">No audio yet‚Äîbe the first to post.</p>';
        }
        posts.forEach(post => {
          const container = document.createElement('div');
          container.className = 'audio-post';

          const meta = document.createElement('div');
          meta.className = 'meta';
          meta.textContent = `${post.sender} ‚Äî ${post.timestamp}`;

          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = resolveFileUrl(post.file);

          container.appendChild(meta);
          container.appendChild(audio);
          feed.appendChild(container);
        });
        setStatus('');
      } catch (err) {
        console.error(err);
        setStatus('Failed to load posts. Check if the backend is running and public.', true);
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      setStatus('Uploading...');
      const senderInput = form.querySelector('input[name="sender"]');
      const fileInput = form.querySelector('input[type="file"]');
      const formData = new FormData();
      formData.append('sender', senderInput.value);

      if (fileInput.files.length > 0) {
        formData.append('audio', fileInput.files[0]);
      } else if (recordedChunks.length > 0) {
        const blob = new Blob(recordedChunks, { type: 'audio/webm' });
        formData.append('audio', blob, 'recording.webm');
      } else {
        setStatus('Please select or record an audio file.', true);
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/upload`, {
          method: 'POST',
          body: formData
        });
        if (!res.ok) throw new Error(`Upload failed: ${res.status}`);
        await res.json();
        form.reset();
        recordedChunks = [];
        recordedAudio.style.display = 'none';
        await loadAudioList();
        setStatus('Uploaded!');
        setTimeout(() => setStatus(''), 1000);
      } catch (err) {
        console.error(err);
        setStatus('Upload failed. Ensure the backend is public and CORS allows this origin.', true);
      }
    });

    recordBtn.addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        recordedChunks = [];

        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: 'audio/webm' });
          recordedAudio.src = URL.createObjectURL(blob);
          recordedAudio.style.display = 'block';
        };

        mediaRecorder.start();
        recordBtn.disabled = true;
        stopBtn.disabled = false;
      } catch (err) {
        console.error(err);
        setStatus('Microphone unavailable. Use a file upload instead.', true);
      }
    });

    stopBtn.addEventListener('click', () => {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
      }
      recordBtn.disabled = false;
      stopBtn.disabled = true;
    });

    window.addEventListener('DOMContentLoaded', loadAudioList);
  </script>
</body>
</html>
