<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StenoGraphs</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/new-swc.png" type="image/png" />
    <style>

body {
    font-family: 'Roboto', sans-serif;
    background-color: #f0f2f5;
    color: #333;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.app-container {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    width: 95%;
    max-width: 1400px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    height: 90vh;
}

.app-header {
    background-color: #7ed700;
    color: #fff;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
}

.app-header h1 {
    margin: 0;
    font-size: 1.8rem;
}

.header-badges {
    display: flex;
    gap: 10px;
}

.badge {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 0.9rem;
}

.ribbon {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding: 0.8rem 2rem;
    background-color: #e3e6e8;
    border-bottom: 1px solid #ccc;
    flex-wrap: wrap;
    gap: 20px;
}

.ribbon-group {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.ribbon-label {
    font-size: 0.8rem;
    color: #555;
    margin-bottom: 5px;
    font-weight: bold;
}

.ribbon-items {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.ribbon-item {
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.ribbon-item:hover {
    background-color: #ddd;
}

.ribbon-item.active {
    background-color: #0078d7;
    color: #fff;
    border-color: #005a9e;
}

.render-button {
    background-color: #28a745;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
}

.render-button:hover {
    background-color: #218838;
}

.content-container {
    display: flex;
    flex: 1;
    min-height: 0;
}

.chart-container {
    flex: 3;
    padding: 2rem;
    position: relative;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    min-width: 500px;
}

#chart-canvas {
    max-width: 100%;
    max-height: 100%;
}

.options-panel {
    flex: 1;
    background-color: #f5f5f5;
    border-left: 1px solid #ddd;
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    overflow-y: auto;
    min-width: 250px;
}

.tabs {
    display: flex;
    margin-bottom: 1rem;
    border-bottom: 2px solid #ddd;
}

.tab-button {
    background-color: transparent;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    font-size: 1rem;
    color: #555;
    transition: color 0.2s, border-bottom 0.2s;
}

.tab-button.active {
    color: #0078d7;
    border-bottom: 2px solid #0078d7;
}

.tab-panel {
    display: none;
}

.tab-panel.active {
    display: block;
}

.control-group {
    margin-bottom: 1.5rem;
}

.control-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.control-group input[type="text"],
.control-group input[type="number"],
.control-group select {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    font-size: 1rem;
}

.data-panel {
    display: none;
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 50%; /* Adjust as needed */
    background: #fff;
    border-top: 2px solid #ccc;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
    z-index: 100;
    flex-direction: column;
    padding: 1rem;
    box-sizing: border-box;
}

.data-panel.active {
    display: flex;
}

#dataInput {
    flex: 1;
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-family: 'Courier New', Courier, monospace;
    font-size: 0.9rem;
    padding: 10px;
    box-sizing: border-box;
    resize: none;
}

#btnRenderBottom {
    margin-top: 1rem;
    align-self: flex-end;
}
      
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>StenoGraphs</h1>
            <div class="header-badges">
                <span id="chartTypeBadge" class="badge">Type: line</span>
                <span id="dataModeBadge" class="badge">Data: JSON</span>
            </div>
        </header>

        <div class="ribbon">
            <div class="ribbon-group">
                <span class="ribbon-label">Chart Type</span>
                <div class="ribbon-items">
                    <button class="ribbon-item chart-type" data-type="line">Line</button>
                    <button class="ribbon-item chart-type" data-type="bar">Bar</button>
                    <button class="ribbon-item chart-type" data-type="column">Column</button>
                    <button class="ribbon-item chart-type" data-type="pie">Pie</button>
                    <button class="ribbon-item chart-type" data-type="area">Area</button>
                    <button class="ribbon-item chart-type" data-type="radar">Radar</button>
                    <button class="ribbon-item chart-type" data-type="scatter">Scatter</button>
                    <button class="ribbon-item chart-type" data-type="bubble">Bubble</button>
                    <button class="ribbon-item chart-type" data-type="waterfall">Waterfall</button>
                    <button class="ribbon-item chart-type" data-type="histogram">Histogram</button>
                </div>
            </div>
            
            <div class="ribbon-group">
                <span class="ribbon-label">Data</span>
                <div class="ribbon-items">
                    <button class="ribbon-item" id="modeJSON">JSON</button>
                    <button class="ribbon-item" id="modeCSV">CSV</button>
                    <button class="ribbon-item" id="btnSample">Sample</button>
                    <button class="ribbon-item" id="btnClear">Clear</button>
                    <button class="ribbon-item" id="btnAddSeries">Add series</button>
                    <button class="ribbon-item" id="btnRemoveSeries">Remove series</button>
                    <button class="ribbon-item" id="btnDataPanel">Edit Data</button>
                </div>
            </div>

            <div class="ribbon-group">
                <span class="ribbon-label">Export</span>
                <div class="ribbon-items">
                    <button class="ribbon-item" id="btnExportPNG">Export PNG</button>
                    <button class="ribbon-item" id="btnCopyConfig">Copy Config</button>
                </div>
            </div>

            <button id="btnRender" class="render-button">Render Chart</button>
        </div>

        <div class="content-container">
            <div class="chart-container">
                <canvas id="chart-canvas"></canvas>
            </div>
            
            <div class="options-panel">
                <div class="tabs">
                    <button class="tab-button active" data-tab="tab-chart-options">Chart Options</button>
                    <button class="tab-button" data-tab="tab-axis-options">Axis & Scales</button>
                    <button class="tab-button" data-tab="tab-advanced-options">Advanced</button>
                </div>

                <div id="tab-chart-options" class="tab-panel active">
                    <div class="control-group">
                        <label for="chartTitle">Chart Title</label>
                        <input type="text" id="chartTitle" value="Chart Title">
                    </div>
                    <div class="control-group">
                        <label for="legendPos">Legend Position</label>
                        <select id="legendPos">
                            <option value="top">Top</option>
                            <option value="bottom">Bottom</option>
                            <option value="left">Left</option>
                            <option value="right">Right</option>
                            <option value="hidden">Hidden</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="palette">Color Palette</label>
                        <select id="palette">
                            <option value="classic">Classic</option>
                            <option value="pastel">Pastel</option>
                            <option value="vivid">Vivid</option>
                            <option value="mono">Mono</option>
                        </select>
                    </div>
                </div>

                <div id="tab-axis-options" class="tab-panel">
                    <div class="control-group">
                        <label for="xTitle">X-Axis Title</label>
                        <input type="text" id="xTitle" value="">
                    </div>
                    <div class="control-group">
                        <label for="yTitle">Y-Axis Title</label>
                        <input type="text" id="yTitle" value="">
                    </div>
                    <div class="control-group">
                        <label for="yMin">Y-Axis Min</label>
                        <input type="number" id="yMin">
                    </div>
                    <div class="control-group">
                        <label for="yMax">Y-Axis Max</label>
                        <input type="number" id="yMax">
                    </div>
                </div>

                <div id="tab-advanced-options" class="tab-panel">
                    <div class="control-group">
                        <label for="anim">Animation</label>
                        <select id="anim">
                            <option value="true">On</option>
                            <option value="false">Off</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="tooltips">Tooltips</label>
                        <select id="tooltips">
                            <option value="true">On</option>
                            <option value="false">Off</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="smoothness">Line Smoothness</label>
                        <input type="number" id="smoothness" value="0.4" min="0" max="1" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="stacked">Stacked</label>
                        <select id="stacked">
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="aspect">Aspect Ratio</label>
                        <select id="aspect">
                            <option value="auto">Auto</option>
                            <option value="16/9">16:9</option>
                            <option value="4/3">4:3</option>
                            <option value="1/1">1:1</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="showValues">Show Values</label>
                        <select id="showValues">
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="histBins">Histogram Bins</label>
                        <input type="number" id="histBins" value="10" min="1" max="50">
                    </div>
                </div>
            </div>
        </div>

        <div id="dataPanel" class="data-panel">
            <textarea id="dataInput"></textarea>
            <button id="btnRenderBottom" class="render-button">Render Chart</button>
        </div>
   <p>&copy; 2025 Stenoip Company</p>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script>

// Register the Chart.js datalabels plugin
Chart.register(ChartDataLabels);

// Application state object to store key variables
var appState = {
    chartType: 'line',
    dataMode: 'JSON',
    chart: null,
    sampleData: {
        'line': {
            "labels": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul"],
            "datasets": [{
                "label": "Revenue",
                "data": [65, 59, 80, 81, 56, 55, 40],
            }, {
                "label": "Cost",
                "data": [28, 48, 40, 19, 86, 27, 90],
            }]
        },
        'bar': {
            "labels": ["Mon", "Tue", "Wed", "Thu", "Fri"],
            "datasets": [{
                "label": "Sessions",
                "data": [12, 19, 3, 5, 2]
            }]
        },
        'column': {
            "labels": ["Jan", "Feb", "Mar", "Apr"],
            "datasets": [{
                "label": "Sales",
                "data": [12, 19, 13, 25]
            }]
        },
        'area': {
            "labels": ["2019", "2020", "2021", "2022", "2023"],
            "datasets": [{
                "label": "iOS",
                "data": [20, 25, 30, 42, 50]
            }, {
                "label": "Android",
                "data": [28, 33, 35, 38, 44]
            }]
        },
        'pie': {
            "labels": ["Alpha", "Beta", "Gamma", "Delta"],
            "datasets": [{
                "label": "Segments",
                "data": [35, 25, 20, 20],
                "backgroundColor": [
                    "#4c78a8",
                    "#f58518",
                    "#e45756",
                    "#72b7b2"
                ]
            }]
        },
        'histogram': {
            "labels": [],
            "datasets": [{
                "label": "Measurements",
                "data": [1.2, 1.5, 1.7, 1.8, 2.2, 2.6, 2.8, 3.0]
            }]
        },
        'scatter': {
            "labels": [],
            "datasets": [{
                "label": "Set 1",
                "data": [{ "x": 1, "y": 1 }, { "x": 2, "y": 1.2 }, { "x": 3, "y": 2.5 }]
            }, {
                "label": "Set 2",
                "data": [{ "x": 1, "y": 0.8 }, { "x": 2, "y": 1.7 }, { "x": 3, "y": 1.9 }]
            }]
        },
        'radar': {
            "labels": ["Speed", "Reliability", "Usability", "Features", "Security", "Support"],
            "datasets": [{
                "label": "Product A",
                "data": [65, 59, 90, 81, 56, 55]
            }, {
                "label": "Product B",
                "data": [28, 48, 40, 19, 96, 27]
            }]
        },
        'bubble': {
            "labels": [],
            "datasets": [{
                "label": "Markets",
                "data": [{ "x": 10, "y": 20, "r": 12 }, { "x": 15, "y": 12, "r": 18 }, { "x": 25, "y": 30, "r": 20 }]
            }]
        },
        'waterfall': {
            "labels": ["Start", "Sales", "COGS", "Marketing", "R&D", "Other", "Net"],
            "datasets": [{
                "label": "Cashflow",
                "data": [100, 60, -30, -10, -8, -2]
            }]
        }
    },
    chartOptions: {
        'default': {
            plugins: {
                tooltip: { enabled: true },
                legend: { display: true, position: 'top' },
                title: { display: true, text: 'Chart Title' },
            },
            responsive: true,
            maintainAspectRatio: false,
            animation: { duration: 1000 },
            scales: {
                x: { title: { display: false, text: '' } },
                y: { title: { display: false, text: '' }, min: undefined, max: undefined }
            },
        },
        'pie': {
            plugins: {
                tooltip: { enabled: true },
                legend: { display: true, position: 'top' },
                title: { display: true, text: 'Pie Chart' },
            },
            animation: true,
        },
        'scatter': {
            scales: {
                x: { type: 'linear', position: 'bottom', title: { display: false, text: 'X Axis' } },
                y: { title: { display: false, text: 'Y Axis' } }
            }
        },
        'bubble': {
            scales: {
                x: { type: 'linear', position: 'bottom', title: { display: false, text: 'X Axis' } },
                y: { title: { display: false, text: 'Y Axis' } }
            }
        },
        'radar': {
            scales: {
                r: { angleLines: { display: true }, suggestedMin: 0, suggestedMax: 100 }
            }
        },
        'waterfall': {
            scales: {
                x: { title: { display: false } },
                y: { stacked: true, title: { display: false } }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            var label = context.dataset.label || '';
                            if (label) { label += ': '; }
                            label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.raw.y || context.raw);
                            return label;
                        }
                    }
                }
            }
        }
    }
};

// Map custom chart types to Chart.js types
var chartTypeMap = { 'bar': 'bar', 'column': 'bar', 'line': 'line', 'area': 'line', 'pie': 'pie', 'histogram': 'bar', 'scatter': 'scatter', 'radar': 'radar', 'bubble': 'bubble', 'waterfall': 'bar' };
var getChartJSType = (appType) => chartTypeMap[appType] || 'bar';

// Color palettes
var palettes = {
    'classic': ['#4c78a8', '#f58518', '#e45756', '#72b7b2', '#54a24b', '#eeca3b', '#b279a2', '#ff9da7'],
    'pastel': ['#aec7e8', '#ffbb78', '#98df8a', '#ff9896', '#c5b0d5', '#c49c94', '#f7b6d2', '#c7c7c7'],
    'vivid': ['#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4', '#46f0f0', '#f032e6'],
    'mono': ['#2a6ad7', '#4683de', '#619cf5', '#7db2ff', '#99c6ff', '#b3d3ff', '#ccdeff', '#e6f0ff']
};
var getColor = (index) => palettes[document.getElementById('palette').value][index % palettes[document.getElementById('palette').value].length];

// Function to parse CSV data
var parseCSV = function(csv) {
    var lines = csv.trim().split('\n');
    if (lines.length < 2) return null;
    var headers = lines[0].split(',').map(h => h.trim());
    var dataRows = lines.slice(1).map(line => line.split(',').map(s => s.trim()));
    var labels = dataRows.map(row => row[0]);
    var datasets = [];
    if (appState.chartType === 'scatter' || appState.chartType === 'bubble') {
        var xIndex = headers.indexOf('x'), yIndex = headers.indexOf('y'), rIndex = headers.indexOf('r'), labelIndex = headers.indexOf('label');
        if (xIndex === -1 || yIndex === -1) return null;
        var groupedData = dataRows.reduce((acc, row) => {
            var label = row[labelIndex] || 'Series';
            if (!acc[label]) acc[label] = [];
            var point = { x: parseFloat(row[xIndex]), y: parseFloat(row[yIndex]) };
            if (rIndex !== -1) point.r = parseFloat(row[rIndex]);
            acc[label].push(point);
            return acc;
        }, {});
        for (var label in groupedData) datasets.push({ label, data: groupedData[label] });
    } else {
        for (var i = 1; i < headers.length; i++) {
            datasets.push({ label: headers[i], data: dataRows.map(row => parseFloat(row[i])) });
        }
    }
    return { labels, datasets };
};

// Function to parse JSON data
var parseJSON = function(json) {
    try {
        return JSON.parse(json);
    } catch (e) {
        console.error("Invalid JSON:", e);
        return null;
    }
};

// Function to handle the export
var exportChart = function() {
    if (appState.chart) {
        var link = document.createElement('a');
        link.download = `stenograph-${appState.chartType}.png`;
        link.href = appState.chart.toBase64Image();
        link.click();
    }
};

// Function to build the final chart configuration
var buildConfig = function(parsedData) {
    if (!parsedData) return null;
    var chartType = getChartJSType(appState.chartType);
    var options = JSON.parse(JSON.stringify(appState.chartOptions['default'])); // Deep copy
    Object.assign(options, appState.chartOptions[appState.chartType]);

    options.plugins.title.text = document.getElementById('chartTitle').value;
    options.plugins.legend.position = document.getElementById('legendPos').value;
    options.plugins.legend.display = document.getElementById('legendPos').value !== 'hidden';
    options.animation.duration = document.getElementById('anim').value === 'true' ? 1000 : 0;
    options.plugins.tooltip.enabled = document.getElementById('tooltips').value === 'true';

    if (options.scales && options.scales.x) {
        options.scales.x.title.display = document.getElementById('xTitle').value.length > 0;
        options.scales.x.title.text = document.getElementById('xTitle').value;
    }
    if (options.scales && options.scales.y) {
        options.scales.y.title.display = document.getElementById('yTitle').value.length > 0;
        options.scales.y.title.text = document.getElementById('yTitle').value;
        var yMin = document.getElementById('yMin').value, yMax = document.getElementById('yMax').value;
        options.scales.y.min = yMin ? parseFloat(yMin) : undefined;
        options.scales.y.max = yMax ? parseFloat(yMax) : undefined;
    }

    parsedData.datasets.forEach(function(dataset, index) {
        if (appState.chartType === 'pie') {
            if (!dataset.backgroundColor) dataset.backgroundColor = dataset.data.map((_, i) => getColor(i));
        } else {
            var color = getColor(index);
            if (!dataset.backgroundColor) dataset.backgroundColor = color;
            if (!dataset.borderColor) dataset.borderColor = color;
        }

        dataset.borderWidth = 2;

        if (appState.chartType === 'line' || appState.chartType === 'area') {
            dataset.tension = parseFloat(document.getElementById('smoothness').value);
            dataset.fill = appState.chartType === 'area';
        }
    });

    var isStacked = document.getElementById('stacked').value === 'true';
    if (isStacked && (chartType === 'bar' || chartType === 'line')) {
        options.scales.x.stacked = true;
        options.scales.y.stacked = true;
    }

    var aspect = document.getElementById('aspect').value;
    options.aspectRatio = (aspect !== 'auto') ? eval(aspect) : undefined;

    options.plugins.datalabels = (document.getElementById('showValues').value === 'true') ? { anchor: 'end', align: 'top', formatter: val => val } : { display: false };

    return { type: chartType, data: parsedData, options: options };
};

// Main function to render the chart
var renderChart = function() {
    var canvas = document.getElementById('chart-canvas');
    var dataInput = document.getElementById('dataInput').value;
    var parsedData = (appState.dataMode === 'JSON') ? parseJSON(dataInput) : parseCSV(dataInput);
    if (!parsedData) { console.error("Data parsing failed."); return; }

    if (appState.chartType === 'histogram' && parsedData.datasets.length > 0) {
        var rawData = parsedData.datasets[0].data, bins = parseInt(document.getElementById('histBins').value, 10);
        if (rawData.length > 0) {
            var dataMin = Math.min(...rawData), dataMax = Math.max(...rawData);
            var binSize = (dataMax - dataMin) / bins;
            var binnedData = Array(bins).fill(0);
            var binLabels = Array.from({ length: bins }, (_, i) => `${(dataMin + i * binSize).toFixed(2)}-${(dataMin + (i + 1) * binSize).toFixed(2)}`);
            rawData.forEach(val => {
                var binIndex = Math.min(bins - 1, Math.floor((val - dataMin) / binSize));
                binnedData[binIndex]++;
            });
            parsedData = { labels: binLabels, datasets: [{ label: parsedData.datasets[0].label, data: binnedData }] };
        }
    }

    var config = buildConfig(parsedData);
    if (!config) return;
    if (appState.chart) appState.chart.destroy();
    appState.chart = new Chart(canvas, config);
};

// Functions to add/remove data series
var addSeries = function() {
    var dataInput = document.getElementById('dataInput');
    if (appState.dataMode === 'JSON') {
        try {
            var data = JSON.parse(dataInput.value);
            if (data && data.datasets) {
                var newSeriesData = Array(data.labels.length).fill(0).map(() => Math.floor(Math.random() * 100));
                data.datasets.push({ label: `Series ${data.datasets.length + 1}`, data: newSeriesData });
                dataInput.value = JSON.stringify(data, null, 2);
            }
        } catch (e) { alert('Invalid JSON data.'); }
    } else {
        var lines = dataInput.value.trim().split('\n');
        lines[0] += `,New Series`;
        for (let i = 1; i < lines.length; i++) lines[i] += `,${Math.floor(Math.random() * 100)}`;
        dataInput.value = lines.join('\n');
    }
    renderChart();
};

var removeSeries = function() {
    var dataInput = document.getElementById('dataInput');
    if (appState.dataMode === 'JSON') {
        try {
            var data = JSON.parse(dataInput.value);
            if (data.datasets.length > 1) {
                data.datasets.pop();
                dataInput.value = JSON.stringify(data, null, 2);
            } else alert('Cannot remove the last series.');
        } catch (e) { alert('Invalid JSON data.'); }
    } else {
        var lines = dataInput.value.trim().split('\n');
        if (lines[0].split(',').length > 2) {
            dataInput.value = lines.map(line => line.substring(0, line.lastIndexOf(','))).join('\n');
        } else alert('Cannot remove the last data series.');
    }
    renderChart();
};

// Initialize the application and set up event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Tab functionality
    document.querySelectorAll('.tab-button').forEach(tab => {
        tab.addEventListener('click', e => {
            document.querySelectorAll('.tab-button, .tab-panel').forEach(el => el.classList.remove('active'));
            e.target.classList.add('active');
            document.getElementById(e.target.dataset.tab).classList.add('active');
        });
    });

    // Chart type selection
    document.querySelectorAll('.chart-type').forEach(btn => {
        btn.addEventListener('click', e => {
            appState.chartType = e.target.dataset.type;
            document.querySelectorAll('.chart-type').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            document.getElementById('chartTypeBadge').textContent = `Type: ${appState.chartType}`;
            document.getElementById('dataInput').value = JSON.stringify(appState.sampleData[appState.chartType], null, 2);
            renderChart();
        });
    });

    // Data mode selection
    document.getElementById('modeJSON').addEventListener('click', () => {
        appState.dataMode = 'JSON';
        document.getElementById('dataModeBadge').textContent = 'Data: JSON';
        document.getElementById('modeJSON').classList.add('active');
        document.getElementById('modeCSV').classList.remove('active');
    });
    document.getElementById('modeCSV').addEventListener('click', () => {
        appState.dataMode = 'CSV';
        document.getElementById('dataModeBadge').textContent = 'Data: CSV';
        document.getElementById('modeCSV').classList.add('active');
        document.getElementById('modeJSON').classList.remove('active');
        document.getElementById('dataInput').value = "Month,Revenue,Cost\nJan,12,8\nFeb,19,11\nMar,13,9";
        renderChart();
    });

    // Data control buttons
    document.getElementById('btnSample').addEventListener('click', () => {
        document.getElementById('dataInput').value = (appState.dataMode === 'JSON') ? JSON.stringify(appState.sampleData[appState.chartType], null, 2) : "Month,Revenue,Cost\nJan,12,8\nFeb,19,11\nMar,13,9";
        renderChart();
    });
    document.getElementById('btnClear').addEventListener('click', () => {
        document.getElementById('dataInput').value = '';
        if (appState.chart) appState.chart.destroy();
    });

    // Render, Series, and Data Panel buttons
    document.getElementById('btnRender').addEventListener('click', renderChart);
    document.getElementById('btnRenderBottom').addEventListener('click', () => {
        renderChart();
        document.getElementById('dataPanel').classList.remove('active');
    });
    document.getElementById('btnAddSeries').addEventListener('click', addSeries);
    document.getElementById('btnRemoveSeries').addEventListener('click', removeSeries);
    document.getElementById('btnDataPanel').addEventListener('click', () => document.getElementById('dataPanel').classList.toggle('active'));

    // Export functionality
    document.getElementById('btnExportPNG').addEventListener('click', () => {
        if (appState.chart) exportChart();
        else alert('Please render a chart first.');
    });
    document.getElementById('btnCopyConfig').addEventListener('click', () => {
        if (appState.chart) {
            navigator.clipboard.writeText(JSON.stringify(appState.chart.config, null, 2))
                .then(() => alert('Chart config copied to clipboard!'))
                .catch(err => console.error('Failed to copy config:', err));
        } else alert('Please render a chart first.');
    });

    // Set initial data and render chart on page load
    document.getElementById('dataInput').value = JSON.stringify(appState.sampleData.line, null, 2);
    document.querySelector('.chart-type[data-type="line"]').classList.add('active');
    document.getElementById('modeJSON').classList.add('active');
    renderChart();
});

    </script>
</body>
</html>
